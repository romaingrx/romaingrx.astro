---
import { getCollection, getEntry, render } from 'astro:content';

import { components } from '@/components/blog/components/index.astro';
import BlogPost from '@/layouts/BlogPost.astro';

export async function getStaticPaths() {
  const posts = await getCollection('blog');
  return posts.map(post => ({
    params: { slug: post.id },
    props: { post },
  }));
}

const { post } = Astro.props;
const { Content } = await render(post);

// Resolve author references
const authors = await Promise.all(
  post.data.authors.map(async authorRef => {
    const author = await getEntry(authorRef);
    if (!author) throw new Error(`Author ${authorRef.id} not found`);
    return author;
  })
);
---

<BlogPost blog={post} authors={authors}>
  <Content components={components} />
</BlogPost>
